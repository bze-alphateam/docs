# Testnet Full Node & Validator

<!-- MarkdownTOC autolink="true" -->

- [Testnet Full Node & Validator](#testnet-full-node--validator)
  - [SECTION 0: Requirements](#section-0-requirements)
  - [SECTION 1: System preparation](#section-1-system-preparation)
    - [Add dedicated user](#add-dedicated-user)
    - [Go deployment](#go-deployment)
      - [Download and extract repository](#download-and-extract-repository)
    - [Firewall Configuration](#firewall-configuration)
    - [systemd Service Configuration](#systemd-service-configuration)
  - [SECTION 2: Build and Initiate Beezee Testnet Node](#section-2-build-and-initiate-beezee-testnet-node)
    - [Add Go environmental variables](#add-go-environmental-variables)
    - [Build Beezee binaries](#build-beezee-binaries)
    - [Beezee Node Init](#beezee-node-init)
    - [Start node](#start-node)
  - [SECTION 3: Promote Full Node to Validator Role](#section-3-promote-full-node-to-validator-role)
    - [Create Wallet](#create-wallet)
    - [Create Validator](#create-validator)

<!-- /MarkdownTOC -->

## SECTION 0: Requirements

- Ubuntu 20.04 LTS

**Minimum**

- 2 CPUs
- 4GB RAM
- 200GB SSD

**Recommended**

- 4 CPUs
- 8GB RAM
- 1TB SSD

## SECTION 1: System preparation

::: tip NOTE:
All tasks in **SECTION 1** have to be performed as **root**
:::

### Add dedicated user

```bash
sudo adduser testbze
```

### Go deployment

#### Download and extract repository

```bash
GOVER=$(curl https://go.dev/VERSION?m=text)
wget https://golang.org/dl/${GOVER}.linux-amd64.tar.gz
sudo rm -rf /usr/local/go && sudo tar -C /usr/local -xzf ${GOVER}.linux-amd64.tar.gz
```

**NOTE**: That will install latest version of Go

### Firewall Configuration

```bash
ufw limit ssh/tcp comment 'Rate limit for openssh server'
ufw default deny incoming
ufw default allow outgoing
ufw allow 26656/tcp comment 'Cosmos SDK/Tendermint P2P (Beezee Testnet Validator)'
ufw enable
```

### systemd Service Configuration

Create service file **_/lib/systemd/system/testbze.service_** for **Beezee Testnet Validator** with following content:

```bash
[Unit]
Description=Beezee Testnet Validator
After=network.target

[Service]
Group=testbze
User=testbze
WorkingDirectory=/home/testbze
ExecStart=/home/testbze/.local/bin/testbzed start
Restart=on-failure
RestartSec=3
LimitNOFILE=8192

[Install]
WantedBy=multi-user.target
```

Once file is created you can reload systemd configuration and enable service.

```bash
systemctl daemon-reload && systemctl enable testbze.service
```

## SECTION 2: Build and Initiate Beezee Testnet Node

::: tip NOTE:
All tasks in **SECTION 2** have to be performed as **testbze** user created in **SECTION 1**
:::

### Add Go environmental variables

Set of variables, which should be set for user(s) with need to build Go apps.

Add Golang specific variables to `${HOME}/.profile`

```bash
# add environmental variables for Go
if [ -f "/usr/local/go/bin/go" ] ; then
    export GOROOT=/usr/local/go
    export GOPATH=${HOME}/go
    export GOBIN=$GOPATH/bin
    export PATH=${PATH}:${GOROOT}/bin:${GOBIN}
fi
```

Once modified and saved, reload `${HOME}/.profile` to set variables in current user session

```bash
. ~/.profile
```

### Build Beezee binaries

Before we build binaries for Beezee testnet node/validator we create folder where binaries will be stored.
Ubuntu adds this folder to search path, when it exists, so we can easily run binaries in future when needed.

```bash
mkdir -p ${HOME}/.local/bin
. ~/.profile
```

Now clone GitHub repository with Beezee source code, build binaries and place in correct folder.

```bash
git clone **COOMING SOON** && cd testbze && make install
mv ${HOME}/go/bin/testbzed ${HOME}/.local/bin
```

### Beezee Node Init

```bash
testbzed init NODE_NAME --chain-id testbeezee-1
```

::: tip NOTE:
Replace NODE_NAME with name you want to assign to your validator.
:::

In **_\${HOME}/.testbze/config/config.toml_** fine line which starts with **_persistent_peers =_** and replace with following content

```bash
persistent_peers =“e7ef78bb156f04f667e4a23a0782e4b1bb673165@216.128.150.25:26656,b9361329891f1acda1f93e55f73642736759e5bb@66.42.124.230:26656”
```

Now it is time to download **_genesis.json_** file, which will allow node synchronization

```bash
wget **COMING SOON** -O ${HOME}/.testbze/config/genesis.json
```

### Start node

Once node is configured you can start it and synchronize chain database.

```bash
sudo systemctl start testbze.service
```

To keep watching logs generated by Beezee node use command below.

```bash
journalctl -u testbze -f
```

To check, if node is synchronized.

```bash
curl http://localhost:26657/status
```

You will see JSON output where you need to locate **_catching_up_** field. When it will have value **_true_** means node is still synchronizing. When value is **_false_** means node is fully synchronized. Then you can move on to creating validator.

```json
........
    },
    "sync_info": {
      "latest_block_hash": "39B4F3361E27EEC32605DA2F554FE2C64EAB41A78B593531CC5E11EEDE9AD67C",
      "latest_app_hash": "05E9931EAF0284B4024D5393B8878146C1CFE0329183EE6084BD4EF48507FA29",
      "latest_block_height": "544241",
      "latest_block_time": "2021-11-29T20:26:22.352845323Z",
      "earliest_block_hash": "5614A5F7D398CCAC49EFB255D1F92421891B725808E31421317BDD519D35F7CA",
      "earliest_app_hash": "E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855",
      "earliest_block_height": "1",
      "earliest_block_time": "2021-10-23T00:00:00Z",
      "catching_up": false
    },
........
```

## SECTION 3: Promote Full Node to Validator Role

::: tip NOTE:
All tasks in **SECTION 3** have to be performed as **testbze** user created in **SECTION 1**.
Steps in this section will allow to promote full node to validator role. If you need full node only, skip this section.
:::

In order to create validator you need to have Beezee account and some funds, whcih can be delegated to validator.

### Create Wallet

In order to create Beezee wallet we use binaries we compiled earlier.

```bash
testbzed keys add WALLET_NAME --keyring-backend os
```

You will be asked to provide password, which will protect keyring.

Output of this command will be similar to presented below

```bash
- name: WALLET_NAME
  type: local
  address: testvdl1u9a5u30svfrhajq7jgquc02956lxgezwx2lnkx
  pubkey: '{"@type":"/cosmos.crypto.secp256k1.PubKey","key":"AwCmb1H3nLx9uPqrcAqKQPRYe/chlkK8BWCJh3P3Kkry"}'
  mnemonic: ""


**Important** write this mnemonic phrase in a safe place.
It is the only way to recover your account if you ever forget your password.

some words forming mnemonic seed will be placed here you have to write them down and keep them safe
```

::: tip NOTE:
When you generate wallet in last line you will have line full of random words. This is mnemonic seed (allows to restore wallet). Write that down and keep safe. Using mnemonic you will be able to restore your account on another machine and access your funds. Lost of mnemonic might drive to inability to access your funds stored on Beezee testnet chain.
:::

In order to get some initial funds for your test node/validator you can visit faucet.

- [Beezee Testnet Faucet](https://getbze.com/testnet-faucet)

Once you request funds from faucet check balance on your account:

```bash
testbzed query bank balances testvdl1u9a5u30svfrhajq7jgquc02956lxgezwx2lnkx
```

Output will be similar to this:

```bash
balances:
- amount: "20000000"
  denom: utvdl
pagination:
  next_key: null
  total: "0"
```

::: tip NOTE:
Denomiation presented by command is in uvdl. For your information 1vdl = 1000000uvdl.
:::

### Create Validator

Now we can turn full node into validator using account and funds created in previous steps.

```bash
testbzed tx staking create-validator \
    --commission-max-change-rate="0.05" \
    --commission-max-rate="0.3" \
    --commission-rate="0.1" \
    --amount="10000000uvdl" \
    --pubkey=$(testbzed tendermint show-validator) \
    --website="https://your.website" \
    --details="Description of your validator." \
    --security-contact="contact@your.domain" \
    --moniker=NODE_NAME \
    --chain-id=beezee-1 \
    --min-self-delegation="1" \
    --gas auto \
    --gas-adjustment=1.2 \
    --fees 200000uvdl \
    --from=WALLET_NAME \
    --keyring-backend os
```

Once that is done you should see your node listed in [Beezee Explorer](https://explorer.erialos.me/Testnet-BeeZee/staking)
